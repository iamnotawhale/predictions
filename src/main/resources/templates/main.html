<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" type="text/css">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Main page</title>
    <link rel="icon" th:href="@{/favicon.ico}" sizes="any">
    <link rel="manifest" th:href="@{/site.webmanifest}">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">
            <p class="text-white" th:text="${currentUser.getLogin()}" style="margin-bottom: 0;">Login</p>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarColor01"
                aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarColor01">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link active text-dark">Главная
                        <span class="visually-hidden"></span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/match/today">Матчи сегодня</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/predict">Мои прогнозы</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button"
                       aria-haspopup="true" aria-expanded="false">Выбрать тур</a>
                    <div class="dropdown-menu" style="width: 354px;">
                        <div class="btn-toolbar" role="toolbar">
                            <div class="btn-group me-2" role="group" th:each="i: ${#numbers.sequence(1,38)}"
                                 th:onclick="'javascript:rowWeeks(\'' + ${i} + '\');'">
                                <button type="button" th:if="${currentWeek == i}" class="btn btn-outline-primary btn-sm"
                                        th:text="${i}"></button>
                                <button type="button" th:unless="${currentWeek == i}" class="btn btn-secondary btn-sm"
                                        th:text="${i}"></button>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button"
                       aria-haspopup="true" aria-expanded="false">Прогнозы по турам</a>
                    <div class="dropdown-menu" style="width: 354px;">
                        <div class="btn-toolbar" role="toolbar">
                            <div class="btn-group me-2" role="group" th:each="i: ${#numbers.sequence(1,38)}"
                                 th:onclick="'javascript:rowPredict(\'' + ${i} + '\');'">
                                <button type="button" th:if="${currentWeek == i}" class="btn btn-outline-primary btn-sm"
                                        th:text="${i}"></button>
                                <button type="button" th:unless="${currentWeek == i}" class="btn btn-secondary btn-sm"
                                        th:text="${i}"></button>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/logout">Выйти</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container-fluid bg-primary">
    <img th:src="@{/img/banner3.webp}" class="img-fluid bg-primary">
    <div class="row">
        <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12">
            <div class="card text-white bg-primary border-0">
                <div class="card-header border-0"
                     th:text="${'Текущий тур ' + matchList.get(1).getWeek().getId()}"
                     onclick="window.location.assign('/match/week/current');"></div>
                <div class="card-body" style="padding-left: 0;">
                    <table class="table table-striped table-hover table-sm">
                        <thead th:align="center">
                        <tr>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Home</th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th>Away</th>
                        </tr>
                        </thead>
                        <tbody th:align="center">
                        <th:block th:each="match, iter: ${matchList}">
                            <tr th:data-bs-target="${'#acco'+ iter.index}" data-bs-toggle="collapse"
                                class="accordion-toggle">
                                <td class="align-middle"
                                    th:text="${#temporals.format(match.getLocalDateTime(), 'dd.MM')}">
                                    Date
                                </td>
                                <td class="align-middle" th:text="${match.matchTime}">Time</td>
                                <td><img th:src="${match.homeTeam.getLogo()}" th:width="20"/></td>
                                <td class="align-middle" th:if="${match.status != 'ns'}"
                                    th:text="${match.homeTeamScore}">HT Score
                                </td>
                                <td class="align-middle" th:if="${match.status != 'ns'}" th:text="${match.status}">
                                    Status
                                </td>
                                <td class="align-middle" th:if="${match.status != 'ns'}"
                                    th:text="${match.awayTeamScore}">AT Score
                                </td>
                                <td colspan="3" class="align-middle" th:unless="${match.status != 'ns'}">
                                    <div th:if="${match.odds != null}">
                                    <span class="badge bg-dark2 w-30">
                                        <p class="h7" style="display:inline"
                                           th:text="${match.getOdds().getHomeChance()}"></p>
                                    </span>
                                        <span class="badge bg-dark2 w-30">
                                        <p class="h7" style="display:inline"
                                           th:text="${match.getOdds().getDrawChance()}"></p>
                                    </span>
                                        <span class="badge bg-dark2 w-30">
                                        <p class="h7" style="display:inline"
                                           th:text="${match.getOdds().getAwayChance()}"></p>
                                    </span>
                                    </div>
                                    <div th:unless="${match.odds != null}" th:text="'-'">
                                    </div>
                                </td>
                                <td><img th:src="${match.awayTeam.getLogo()}" th:width="20"/></td>
                            </tr>
                            <tr class="accordion-body collapse" th:id="${'acco'+ iter.index}"
                                th:each="hth: ${h2h.get(iter.index)}">
                                <td colspan="2" class="align-middle">
                                    <div>
                                        <img th:if="${hth.getLeagueName().contains('PL') }"
                                             th:src="'https://media.api-sports.io/football/leagues/39.png'"
                                             th:width="20"/>
                                        <img th:if="${hth.getLeagueName().contains('UCL') }"
                                             th:src="'https://media.api-sports.io/football/leagues/2.png'"
                                             th:width="20"/>
                                        <img th:if="${hth.getLeagueName().contains('CH') }"
                                             th:src="'https://media.api-sports.io/football/leagues/40.png'"
                                             th:width="15"/>
                                        <img th:if="${hth.getLeagueName().contains('LC') }"
                                             th:src="'https://media.api-sports.io/football/leagues/48.png'"
                                             th:width="15"/>
                                        <img th:if="${hth.getLeagueName().contains('FA') }"
                                             th:src="'https://media.api-sports.io/football/leagues/45.png'"
                                             th:width="20"/>
                                        <span th:text="${#temporals.format(hth.getLocalDateTime(), 'dd.MM.YY')}"/>
                                    </div>
                                </td>
                                <td><img th:src="${hth.homeTeam.getLogo()}" th:width="20"/></td>
                                <td colspan="3" class="align-middle"
                                    th:text="${hth.homeTeamScore + ' - ' + hth.awayTeamScore}">Status
                                </td>
                                <td><img th:src="${hth.awayTeam.getLogo()}" th:width="20"/></td>
                            </tr>
                        </th:block>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card text-white bg-primary border-0">
                <div class="card-header border-0">Рейтинг</div>
                <div class="card-body" style="padding-left: 0;">
                    <table class="table table-striped table-hover table-sm text-white">
                        <thead th:align="center">
                        <tr>
                            <th>Место</th>
                            <th>Пользователь</th>
                            <th>Очки</th>
                        </tr>
                        </thead>
                        <tbody th:align="center">
                        <tr th:each="points, iter: ${map}">
                            <td th:text="${iter.index + 1}">Position</td>
                            <td th:text="${points.getKey().getLogin()}">User</td>
                            <td th:text="${points.getValue()}">Points</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12">
            <div class="card text-white bg-primary mb-3 border-0">
                <div class="card-header border-0">Турнирная таблица</div>
                <div class="card-body" style="padding-left: 0;">
                    <table class="table table-striped table-hover table-sm">
                        <thead th:align="center">
                        <tr>
                            <th></th>
                            <th></th>
                            <th class="d-none d-xl-table-cell">
                                Клуб
                            </th>
                            <th></th>
                            <th>И</th>
                            <th>В</th>
                            <th>Н</th>
                            <th>П</th>
                            <th class="d-none d-xl-table-cell">
                                ЗМ
                            </th>
                            <th class="d-none d-xl-table-cell">
                                ПМ
                            </th>
                            <th>РМ</th>
                            <th>О</th>
                        </tr>
                        </thead>

                        <tbody th:align="center">

                        <th:block th:each="standing, iter: ${standings}">
                            <tr th:data-bs-target="${'#acc'+ standing.getTeam()}" data-bs-toggle="collapse"
                                class="accordion-toggle">
                                <td th:text="${iter.index + 1}">Position</td>
                                <td>
                                    <img th:src="${standing.team.getLogo()}" th:width="20" style="display:inline;"/>
                                </td>
                                <td class="d-none d-xl-table-cell">
                                    <p class="text-truncate"
                                       th:text="${standing.team.getCode().toUpperCase()}"
                                       style="display:inline; max-width: 100px;">
                                    </p>
                                </td>
                                <td style="padding-left: 0; padding-right: 0" th:with="match=${@matchServiceImpl.getOnlineResult(standing.team.getTeamName())}">
                                    <span class="text-white p-03 badge rounded-pill bg-success" th:if="${match != null && match.getResult() == 'H'}"
                                    th:text="${match.getHomeTeamScore() + ':' + match.getAwayTeamScore()}">
                                    </span>
                                    <span class="text-white p-03 badge rounded-pill bg-warning" th:if="${match != null && match.getResult() == 'D'}"
                                          th:text="${match.getHomeTeamScore() + ':' + match.getAwayTeamScore()}">
                                    </span>
                                    <span class="text-white p-03 badge rounded-pill bg-danger" th:if="${match != null && match.getResult() == 'A'}"
                                          th:text="${match.getHomeTeamScore() + ':' + match.getAwayTeamScore()}">
                                    </span>
                                </td>
                                <td th:text="${standing.games}">Games</td>
                                <td th:text="${standing.won}">Won</td>
                                <td th:text="${standing.draw}">Draw</td>
                                <td th:text="${standing.lost}">Lost</td>
                                <td class="d-none d-xl-table-cell">
                                    <p class="text-truncate"
                                       th:text="${standing.goalsScored}"
                                       style="display:inline; max-width: 100px;">
                                    </p>
                                </td>
                                <td class="d-none d-xl-table-cell">
                                    <p class="text-truncate"
                                       th:text="${standing.goalsAgainst}"
                                       style="display:inline; max-width: 100px;">
                                    </p>
                                </td>
                                <td th:text="${standing.goalsScored} - ${standing.goalsAgainst}"></td>
                                <td th:text="${standing.points}">Points</td>
                            </tr>
                            <tr class="accordion-body collapse" th:id="${'acc'+ standing.getTeam()}">
                                <td colspan="4">
                                    <div>
                                        <p class="h7" style="margin-bottom: 0;"
                                           th:text="${'Все игры '}"
                                           th:onclick="'javascript:allGames(\'' + ${standing.getTeam().getId()} + '\');'"></p>
                                    </div>
                                </td>
                                <td colspan="4">
                                    <div>
                                        <p class="h7" style="margin-bottom: 0;"
                                           th:text="${'Последние 5 игр'}"
                                           th:onclick="'javascript:lastFiveGames(\'' + ${standing.getTeam().getId()} + '\');'"></p>
                                    </div>
                                </td>
                            </tr>
                        </th:block>

                        </tbody>
                    </table>


                </div>
            </div>
        </div>
        <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12">

            <div class="card text-white bg-primary mb-3 border-0">
                <div class="card-header border-0">Новости АПЛ</div>
                <div class="card-body" style="padding-left: 0;">
                    <div th:align="left" th:each="item, iter: ${news}"
                         class="container-fluid bg-primary">
                        <div class="row">
                            <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">
                                <p class="h8" th:text="${#temporals.format(item.getDateTime(), 'HH:mm')}"></p>
                            </div>
                            <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10">
                                <a th:href="${item.getLink()}" th:class="link-light">
                                    <p class="h7" th:text="${item.getTitle()}"></p>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="row g-0">
        <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
            <div class="card text-white bg-dark mb-3">
                <div class="card-header">
                    <p class="position-relative text-light">
                        Live
                        <span class="p-1 position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                            <span class="visually-hidden"></span>
                        </span>
                    </p>
                </div>
                <div class="card-body">
                    <table class="table table-striped table-hover table-sm text-white" th:if="${!online.isEmpty()}">
                        <thead th:align="center">
                        <tr>
                            <th>Хозяева</th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th>Гости</th>
                        </tr>
                        </thead>
                        <tbody th:align="center">
                        <th:block th:each="match: ${online}">
                            <tr>
                                <td style="width: 35%"><img th:src="${match.homeTeam.getLogo()}" th:width="20"/></td>
                                <td class="align-middle" th:text="${match.homeTeamScore}">HT Score</td>
                                <td class="align-middle" th:if="${match.status != 'ns'}" th:text="${match.status}">
                                    Status
                                </td>
                                <td class="align-middle" th:unless="${match.status != 'ns'}" th:text="'-'">Status</td>
                                <td class="align-middle" th:text="${match.awayTeamScore}">AT Score</td>
                                <td style="width: 35%"><img th:src="${match.awayTeam.getLogo()}" th:width="20"/></td>
                            </tr>
                        </th:block>
                        </tbody>
                    </table>
                    <p th:unless="${!online.isEmpty()}">Матчей онлайн нет</p>
                </div>
            </div>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
            <div class="card text-white bg-dark mb-3">
                <div class="card-header">Highlights</div>
                <div class="card-body">
                    <div class="video-container">
                        <iframe id="ytplayer" type="text/html" width="560" height="315"
                                src="https://www.youtube.com/embed/?listType=playlist&list=PLQ_voP4Q3cfeT5QqIr7RA7BEc2zGMn0nl&iv_load_policy=3"
                                frameborder="0" allowfullscreen></iframe>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>

<script>
    function allGames(value) {
        location.href = "/match/team?id=" + value;
    }
</script>
<script>
    function lastFiveGames(value) {
        location.href = "/team/" + value;
    }
</script>
<script>
    function rowWeeks(value) {
        location.href = "/match/week/" + value;
    }
</script>
<script>
    function rowPredict(value) {
        location.href = "/predict/week/" + value;
    }
</script>
<script>
    function rowNews(value) {
        href = value;
    }
</script>
</div>
</body>
</html>